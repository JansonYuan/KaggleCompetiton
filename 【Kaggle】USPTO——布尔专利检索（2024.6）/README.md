# 【Kaggle】USPTO——布尔专利检索

说明：本项目中包含了部分方案解析、录播课件、baseline、以及推荐资料等，欢迎大家关注点赞+收藏！！！

比赛名称：USPTO——布尔专利检索

比赛链接：https://www.kaggle.com/competitions/uspto-explainable-ai

比赛任务：你的任务是构建一个模型，对于测试集中的每个 `publication_number`，**生成一个布尔搜索查询**。这个查询在专利数据库中进行搜索时，应尽可能**返回且仅返回**该 `publication_number` 对应的50个目标专利（`target_[N]`）

![CleanShot 2025-09-05 at 16.10.06@2x](/Users/apple/Downloads/【Kaggle】USPTO——布尔专利检索（2024.6）/assets/CleanShot 2025-09-05 at 16.10.06@2x.png)

![CleanShot 2025-09-05 at 15.48.26@2x](/Users/apple/Downloads/【Kaggle】 Optiver - Trading at the close（2023.10）/assets/CleanShot 2025-09-05 at 15.48.26@2x.png)

---

<img src="assets/20250904_174246_5b2bcaaac91a0105f71ca56604b8dcb5.png" style="width:500px;" />

欢迎大家了解我们深度之眼，希望能够给大家带去最实用的知识：

https://deepshare.feishu.cn/wiki/Tb7IwetysiLErGk3NQwcQdHznPb?from=from_copylink

---

## 1、比赛简介

专利审查过程中，专业人员需要评估发明是否符合专利授予标准。AI驱动的搜索工具虽能提供相关专利文档的搜索结果（包括文本片段、元数据和相似性分数），但这些结果往往缺乏清晰的解释，无法说明为何特定文档会被检索到。专利专业人员更熟悉使用布尔搜索表达式来确认检索的充分性。因此，本次竞赛的核心目标是开发一个模型，能够将AI搜索工具的结果集转化为专利专业人员熟悉的布尔查询语言。具体来说，参赛者需要根据输入的一组相关专利，生成一个布尔查询，该查询应能精确检索出同一组专利文档，从而帮助专利专业人员更自信地使用AI驱动的搜索功能，并促进AI技术在知识产权生态系统中的负责任采用。

## **2、时间安排**

2024 年 4 月  24 日 - 比赛开始日期

2024 年 7 月  17 日 - 参赛作品提交截止日期 & 团队合并截止日期

2024 年 7 月  24 日- 最终提交截止日期

## **3、整个课程的讲解思路和讲课逻辑是怎么样的？**

**1. 核心任务**

这是一个**自然语言生成（NLG）或查询构造优化问题**，但其核心更侧重于**搜索和优化**。目标不是理解自然语言，而是构造出能精确匹配目标专利集的布尔表达式。

**2. 面向实操**

重点在于掌握**专利文本数据处理**、**布尔查询语法**、**集合覆盖优化算法**以及**高效的集合运算技巧**。由于需要为2500个查询生成结果，且每个查询涉及50个目标专利，**计算效率和内存管理**至关重要。

**3. 关键挑战**

- **精确匹配**：生成的查询需要尽可能只命中目标专利，避免检索到非目标专利，因为引入非目标专利会显著降低mAP@50得分。
- **查询长度限制**：查询不能超过50个标记，这要求查询必须非常精炼。
- **计算复杂度**：直接处理所有专利的全文数据（尤其是`claims`和`description`）计算量巨大，需要巧妙的数据结构和算法优化。

**4. 优化路径**

从**简单的关键词组合或基于CPC代码的查询**开始，逐步过渡到**使用优化算法（如模拟退火、贪婪算法）** 来组合筛选后的关键词或短语，并通过**负面查询（NOT操作）** 来排除常见的非目标专利，不断提升查询的精确度。

#### **01课 比赛介绍与Baseline**

**核心内容**

1. **比赛背景**
   - **目标**：帮助专利专业人员理解AI驱动的搜索结果，通过生成他们熟悉的布尔查询来解释为何返回这些专利。
   - **任务**：为每个测试专利生成一个布尔查询，该查询应返回其50个最近邻专利。
   - **评价指标**：**mAP@50**。
2. **数据集概览**
   - **关键数据**：专利元数据、专利全文（标题、摘要、权利要求、描述）、最近邻列表。
   - **核心约束**：查询令牌数≤50，评估时间限制。
3. **Baseline思路**
   - **简单方法**：使用目标专利集中**共有的CPC代码**或高频关键词构造查询，例如 `cpc:H04L* OR title:("network" AND "security")`。
   - **进阶意识**：意识到**避免检索到非目标专利**是提升得分的关键。

#### **02课 关键词选择与查询构造**

**核心内容**

1. **关键词来源**
   - 优先从**标题（title）、摘要（abstract）、CPC代码**中提取词语，这些字段通常包含专利的核心信息且长度适中。
   - 谨慎处理**权利要求（claims）和描述（description）**，因为它们文本很长且包含大量高频通用词，容易引入噪声。许多优胜方案选择**过滤掉出现频率极高的词语**（例如出现超过10万次的词）。
2. **查询构造策略**
   - **集合覆盖思想**：将每个关键词或短语视为一个集合（包含所有出现该关键词的专利），问题转化为寻找这些集合的某种组合（AND, OR, NOT），使其并集（或差集）尽可能等于目标专利集。
   - **利用“魔法”节省令牌**：优胜方案发现可以利用特定的语法来节省查询中的令牌，例如：
     - **无空格AND**：`ti:"abcd"ab:"efgh"`等效于 `ti:abcd AND ab:efgh`。
     - **无空格n-gram**：`ti:"abcd/efgh"`。
   - **使用否定**：引入 `NOT`操作符来排除那些在正查询中被命中但非目标的专利，这是提升精度的有效手段。

#### **03课 优化算法与高效计算**

**核心内容**

1. **优化算法应用**
   - **模拟退火（Simulated Annealing）**：冠军方案采用模拟退火来优化查询的组合。其邻域操作包括以一定概率添加或移除一个子查询（由一组AND连接的关键词构成），评分函数侧重于覆盖尽可能多的目标专利。
   - **贪婪算法**：另一种常见思路是贪婪地选择能覆盖最多新目标专利的子查询候选，直到覆盖所有目标或达到子查询数量上限。
2. **效率优化技巧**
   - **内存与速度**：处理海量专利文本数据需要极高的效率。
     - **词语和专利ID化**：将所有词语和专利映射为整数ID，大幅提高集合运算速度和减少内存占用。
     - **使用GPU加速**：冠军方案使用 `cupy`库来加速集合交集运算，比Python内置集合快2-3倍。
     - **限制计算范围**：仅加载和处理测试集中实际出现的专利（2500 * 50）相关的数据。
   - **候选生成**：优先生成覆盖少量专利的子查询候选（例如，基于单个专利或两个专利的交集），因为它们更可能精确命中。

#### **04课 优胜方案精要**

**核心内容**

1. **冠军方案（TanakaR）**
   - **核心方法**：模拟退火。
   - **查询结构**：`(ti:word1-ti:word2-detd:word3-…-cpc:wordN) OR …`（使用 `-`省略AND运算符）。
   - **关键优化**：使用CuPy加速集合运算，过滤高频词，按词语数量排序优先使用小集合。
2. **亚军方案**
   - **核心方法**：使用了“魔法”技术（无空格AND、无空格n-gram）来压缩查询。
   - **重要洞察**：测试索引中可能存在与目标专利相似的非目标专利，**确保查询结果中不包含非目标专利（即“零非目标”）** 是获得高分的关键。
3. **第四名方案**
   - **查询结构**：`(subquery1 OR subquery2 OR …) NOT (negative-subquery1 OR negative-subquery2 OR …)`，显式使用NOT来排除非目标专利。
   - **实现语言**：为追求极致效率，主要部分使用**C++** 实现，比Python方案快约5倍，内存效率高约3倍。

#### **05课 避坑指南与总结**

**核心内容**

1. **常见陷阱**
   - **忽视非目标专利**：只关注覆盖目标专利而忽略排除非目标专利会导致得分大幅下降。
   - **计算效率低下**：未优化的Python代码在处理全集数据时可能无法在限制时间内完成，或占用过多内存。
   - **过度依赖高频词**：从`claims`和`description`中不加过滤地使用词语，极易引入噪声，检索到大量无关专利。
2. **成功关键**
   - **零非目标优先**：尽力构造返回专利完全是目标专利的查询。
   - **效率至上**：优化算法和代码，善用GPU和高效数据结构。
   - **理解评分指标**：深入理解mAP@50如何计算，明白结果中专利的顺序（由于基于TF-IDF，难以控制）和数量都会影响分数。

---

说明：需要课程回放的同学可以扫码，凭点赞截图找小享免费领取哦！！！

<img src="assets/20250904_172853_image.png" style="width:200px;" />
